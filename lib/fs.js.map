{
  "version": 3,
  "file": "",
  "sourceRoot": "",
  "sources": [
    "../src/fs.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "\n'use strict'\n\n############################################################################################################\nH                         = require './_helpers'\nmisfit                    = Symbol 'misfit'\nplatform                  = ( require 'os' ).platform()\n\n#-----------------------------------------------------------------------------------------------------------\nH.types.declare 'guy_walk_lines_cfg', tests:\n  \"@isa.object x\":                                                    ( x ) -> @isa.object x\n  \"@isa.boolean x.decode\":                                            ( x ) -> @isa.boolean x.decode\n\n#-----------------------------------------------------------------------------------------------------------\nH.types.declare 'guy_walk_circular_lines_cfg', tests:\n  \"@isa.object x\":                                                    ( x ) -> @isa.object x\n  \"@isa.boolean x.decode\":                                            ( x ) -> @isa.boolean x.decode\n  \"( x.loop_count is +Infinity ) or ( @isa.cardinal x.loop_count )\":  ( x ) -> ( x.loop_count is +Infinity ) or ( @isa.cardinal x.loop_count )\n  \"( x.line_count is +Infinity ) or ( @isa.cardinal x.line_count )\":  ( x ) -> ( x.line_count is +Infinity ) or ( @isa.cardinal x.line_count )\n\n#-----------------------------------------------------------------------------------------------------------\nH.types.declare 'guy_get_content_hash_cfg', tests:\n  \"@isa.object x\":                                                    ( x ) -> @isa.object x\n  \"@isa.cardinal x.length\":                                           ( x ) -> @isa.cardinal x.length\n\n#-----------------------------------------------------------------------------------------------------------\ndefaults =\n  guy_walk_lines_cfg:\n    decode:         true\n  guy_walk_circular_lines_cfg:\n    decode:         true\n    loop_count:     1\n    line_count:     +Infinity\n  guy_get_content_hash_cfg:\n    length:         17\n    fallback:       misfit\n\n#-----------------------------------------------------------------------------------------------------------\n@walk_lines = ( path, cfg ) ->\n  ### TAINT make newline, buffersize configurable ###\n  ### thx to https://github.com/nacholibre/node-readlines ###\n  H.types.validate.guy_walk_lines_cfg ( cfg = { defaults.guy_walk_lines_cfg..., cfg..., } )\n  H.types.validate.nonempty_text path\n  nl            = '\\n'\n  readline_cfg  =\n    readChunk:          16 * 1024 # chunk_size, byte_count\n    newLineCharacter:   nl\n  readlines     = new ( require '../dependencies/n-readlines-patched' ) path, readline_cfg\n  { decode  }   = cfg\n  count         = 0\n  while ( line = readlines.next() ) isnt false\n    count++\n    yield if decode then ( line.toString 'utf-8' ) else line\n  yield ( if decode then '' else Buffer.from '' ) if count is 0\n  return null\n\n#-----------------------------------------------------------------------------------------------------------\n@walk_circular_lines = ( path, cfg ) ->\n  H.types.validate.guy_walk_circular_lines_cfg ( cfg = { defaults.guy_walk_circular_lines_cfg..., cfg..., } )\n  return if ( cfg.line_count is 0 ) or ( cfg.loop_count is 0 )\n  line_count = 0\n  loop_count = 0\n  loop\n    for line from @walk_lines path, { decode: cfg.decode, }\n      yield line\n      line_count++; return null if line_count >= cfg.line_count\n    loop_count++; return null if loop_count >= cfg.loop_count\n  return null\n\n#-----------------------------------------------------------------------------------------------------------\n@get_file_size = ( path, fallback = misfit ) ->\n  H.types.validate.nonempty_text path\n  try return ( ( require 'fs' ).statSync path ).size catch error\n    throw error if ( fallback is misfit )\n    throw error if ( error.code isnt 'ENOENT' )\n  return fallback\n\n#-----------------------------------------------------------------------------------------------------------\n@get_content_hash = ( path, cfg ) ->\n  H.types.validate.nonempty_text path\n  H.types.validate.guy_get_content_hash_cfg ( cfg = { defaults.guy_get_content_hash_cfg..., cfg..., } )\n  CP        = require 'child_process'\n  command   = if platform is 'linux' then 'sha1sum' else 'shasum'\n  result    = CP.spawnSync command, [ '-b', path, ]\n  if result.status isnt 0\n    return cfg.fallback unless cfg.fallback is misfit\n    if result.stderr?\n      throw new Error \"^guy.fs.get_content_hash@1^ \" + result.stderr.toString 'utf-8'\n    else\n      throw new Error \"^guy.fs.get_content_hash@1^ \" + ( require 'util' ).inspect result.error\n  R = result\n  R = R.stdout.toString 'utf-8'\n  R = R.replace /\\s.*$/, ''\n  R = R[ ... cfg.length ]\n  unless R.length is cfg.length\n    throw new Error \"^guy.fs.get_content_hash@1^ unable to generate hash of length #{cfg.length} using #{command}\"\n  return R\n\n#-----------------------------------------------------------------------------------------------------------\n@rename_sync = ( from_path, to_path ) ->\n  ### Same as `FS.renameSync()`, but falls back to `FS.copyFileSync()`, `FS.unlinkSync()` in case device\n  boundaries are crossed. Thx to https://github.com/sindresorhus/move-file/blob/main/index.js ###\n  FS = require 'node:fs'\n  try FS.renameSync from_path, to_path catch error\n    throw error unless error.code is 'EXDEV'\n    FS.copyFileSync from_path, to_path\n    FS.unlinkSync from_path\n  return null\n\n\n\n\n\n\n"
  ]
}